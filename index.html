<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>El Canciller</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Bitter:wght@400;700;800;900&display=swap" rel="stylesheet">

<style>
    body { margin:0; padding:0; font-family:"Bitter",serif; }

    /* HEADER FIJO (solo la barra blanca sigue al scrollear) */
    .sticky-header {
        position: sticky;
        top: 0;
        background: #fff;
        z-index: 999;
        border-bottom: 1px solid #eee;
        cursor:pointer; /* para que se note que es clickeable (cierra modal / va arriba) */
    }

    .header-top {
        display:flex;
        justify-content:space-between;
        align-items:center;
        padding:12px 20px;
    }

    .header-logo {
        font-family:"Montserrat",sans-serif;
        font-size:46px;
        font-weight:700;
        color:#EACB26;
    }

    .weather-box {
        font-family:"Montserrat",sans-serif;
        font-size:16px;
        display:flex;
        align-items:center;
        gap:6px;
    }

    /* BARRA AMARILLA (no sticky) */
    .top-bar {
        background:#EACB26;
        padding:10px 20px;
        display:flex;
        justify-content:space-between;
        align-items:center;
        font-family:"Montserrat",sans-serif;
        font-size:15px;
    }

    /* DESKTOP MAIN */
    .desktop-main {
        max-width: 1200px;
        margin:20px auto;
        padding:0 20px;
        display:grid;
        grid-template-columns: 1fr 1fr;
        gap:30px;
    }

    .primary img { width:100%; height:380px; object-fit:cover; border-radius:4px; }
    .primary h1 { font-size:40px; font-weight:800; margin:15px 0 5px; }
    .primary h2 { font-size:20px; color:#555; margin-top:0; }

    /* GRID 2×2 NOTICIAS 2–5 */
    .grid-2x2 {
        display:grid;
        grid-template-columns:1fr 1fr;
        gap:20px;
    }
    .grid-2x2-item img { width:100%; height:160px; object-fit:cover; border-radius:4px; }
    .grid-2x2-item h3 { font-size:22px; margin:10px 0 0; font-weight:800; }

    /* FEED 6+ */
    .feed {
        max-width:1200px;
        margin:40px auto;
        padding:0 20px;
        display:grid;
        grid-template-columns: repeat(3, 1fr);
        gap:25px;
    }
    .feed-item img { width:100%; height:200px; object-fit:cover; border-radius:4px; }
    .feed-item h4 { font-size:20px; margin-top:8px; font-weight:800; }

    /* Todas las tarjetas clickeables */
    .news-card { cursor:pointer; }
    .news-card:hover h1,
    .news-card:hover h2,
    .news-card:hover h3,
    .news-card:hover h4 {
        text-decoration: underline;
    }

    /* RESPONSIVE: reescalar barras y layout */

    /* Tablets y pantallas medianas */
    @media(max-width: 900px){
        .header-top {
            padding:8px 14px;
        }
        .header-logo {
            font-size:34px;
        }
        .weather-box {
            font-size:14px;
        }
        .top-bar {
            padding:8px 14px;
            font-size:13px;
            flex-direction:column;
            align-items:flex-start;
            gap:4px;
        }

        .desktop-main {
            grid-template-columns:1fr;
        }
        .grid-2x2 {
            grid-template-columns:1fr;
        }
        .feed {
            grid-template-columns:1fr;
        }

        .primary img { height:260px; }
        .grid-2x2-item img,
        .feed-item img { height:220px; }
    }

    /* Móviles chicos */
    @media(max-width: 600px){
        .header-top {
            padding:6px 10px;
        }
        .header-logo {
            font-size:28px;
        }
        .weather-box {
            font-size:13px;
        }
        .top-bar {
            padding:6px 10px;
            font-size:12px;
        }
    }

    /* ---------- MODAL ARTÍCULO ---------- */
    .modal {
        position: fixed;
        inset: 0;
        display: none;
        z-index: 1000;
    }
    .modal.open {
        display: block;
    }
    .modal-backdrop {
        position:absolute;
        inset:0;
        background:rgba(0,0,0,0.55);
    }
    .modal-dialog {
        position:relative;
        max-width:1100px;
        margin:40px auto;
        background:#fff;
        border-radius:6px;
        padding:20px;
        z-index:1;
        max-height:calc(100vh - 80px);
        overflow:auto;
        box-shadow:0 10px 30px rgba(0,0,0,0.25);
    }
    #modal-close {
        position:absolute;
        top:10px;
        right:10px;
        border:none;
        background:transparent;
        font-size:22px;
        cursor:pointer;
    }
    .modal-layout {
        display:flex;
        gap:20px;
        margin-top:10px;
    }
    .modal-main {
        flex:2;
    }
    .modal-main img {
        width:100%;
        max-height:380px;
        object-fit:cover;
        border-radius:4px;
        margin-bottom:10px;
    }
    #modal-title {
        font-size:30px;
        font-weight:800;
        margin:10px 0 5px;
    }
    #modal-subtitle {
        font-size:18px;
        color:#555;
        margin:0 0 15px;
    }
    #modal-body {
        font-size:16px;
        line-height:1.5;
        color:#333;
        white-space:pre-wrap;
    }

    .modal-sidebar {
        flex:1;
        border-left:1px solid #eee;
        padding-left:15px;
        max-height:calc(100vh - 140px);
        overflow-y:auto;
    }
    .modal-sidebar-title {
        font-family:"Montserrat",sans-serif;
        font-size:14px;
        text-transform:uppercase;
        letter-spacing:1px;
        color:#777;
        margin-bottom:10px;
    }
    .modal-side-item {
        display:flex;
        gap:8px;
        margin-bottom:10px;
        cursor:pointer;
    }
    .modal-side-item img {
        width:70px;
        height:70px;
        object-fit:cover;
        border-radius:4px;
        flex-shrink:0;
    }
    .modal-side-item h4 {
        font-size:14px;
        margin:0;
        font-weight:700;
    }
    .modal-side-item:hover h4 {
        text-decoration:underline;
    }

    @media(max-width: 900px){
        .modal-dialog {
            margin:10px;
            max-height:calc(100vh - 20px);
            padding:16px;
        }
        .modal-layout {
            flex-direction:column;
        }
        .modal-sidebar {
            border-left:none;
            border-top:1px solid #eee;
            padding-left:0;
            padding-top:12px;
            max-height:none;
        }
        #modal-title {
            font-size:24px;
        }
        #modal-subtitle {
            font-size:16px;
        }
    }
</style>
</head>
<body>

<!-- HEADER (blanco, sticky y clickeable para cerrar modal / ir arriba) -->
<div class="sticky-header" id="sticky-header">
    <div class="header-top">
        <div style="font-size:24px;">☰</div>
        <div class="header-logo">elCanciller</div>
        <div class="weather-box">⛅ <span id="temp"></span>°C Buenos Aires</div>
    </div>
</div>

<!-- BARRA AMARILLA (no sticky) -->
<div class="top-bar">
    <div id="fecha-hoy"></div>
    <div id="dolar-info">Cargando dólar...</div>
</div>

<!-- DESKTOP / MAIN -->
<div class="desktop-main">
    <div class="primary" id="primary"></div>
    <div class="grid-2x2" id="grid-2x2"></div>
</div>

<!-- FEED -->
<div class="feed" id="feed"></div>

<!-- MODAL ARTÍCULO -->
<div id="article-modal" class="modal" aria-hidden="true">
    <div class="modal-backdrop" id="modal-backdrop"></div>
    <div class="modal-dialog" id="modal-dialog" role="dialog" aria-modal="true">
        <button id="modal-close" aria-label="Cerrar">✕</button>
        <div class="modal-layout">
            <div class="modal-main">
                <img id="modal-image" alt="">
                <h1 id="modal-title"></h1>
                <h2 id="modal-subtitle"></h2>
                <div id="modal-body"></div>
            </div>
            <aside class="modal-sidebar">
                <div class="modal-sidebar-title">Más noticias</div>
                <div id="modal-sidebar-list"></div>
            </aside>
        </div>
    </div>
</div>

<script>
// Fecha dinámica
document.getElementById("fecha-hoy").textContent = new Date().toLocaleDateString("es-ES", {
    weekday:"long", year:"numeric", month:"long", day:"numeric"
});

// Clima
fetch("https://api.open-meteo.com/v1/forecast?latitude=-34.60&longitude=-58.38&current_weather=true")
.then(r=>r.json())
.then(d=>{ document.getElementById("temp").textContent = Math.round(d.current_weather.temperature); });

// Dólar
fetch("https://api.bluelytics.com.ar/v2/latest")
.then(r=>r.json())
.then(d=>{
    document.getElementById("dolar-info").innerHTML =
      `Dólar: BNA $${d.oficial.value_buy} / $${d.oficial.value_sell} · Blue $${d.blue.value_buy} / $${d.blue.value_sell}`;
});

let allRows = [];
const modal = document.getElementById("article-modal");
const modalImage = document.getElementById("modal-image");
const modalTitle = document.getElementById("modal-title");
const modalSubtitle = document.getElementById("modal-subtitle");
const modalBody = document.getElementById("modal-body");
const modalSidebarList = document.getElementById("modal-sidebar-list");
const modalDialog = document.getElementById("modal-dialog");

function openArticle(index) {
    const row = allRows[index];
    if (!row || !row.c) return;
    const c = row.c;

    modalImage.src = c[1]?.v || "";
    modalTitle.textContent = c[0]?.v || "";
    modalSubtitle.textContent = c[2]?.v || "";
    modalBody.textContent = c[3]?.v || "";

    // Sidebar con el resto de noticias
    let sideHtml = "";
    allRows.forEach((r, i) => {
        if (!r || !r.c || i === index) return;
        const cc = r.c;
        sideHtml += `
            <div class="modal-side-item" data-index="${i}">
                <img src="${cc[1]?.v || ""}" alt="">
                <h4>${cc[0]?.v || ""}</h4>
            </div>
        `;
    });
    modalSidebarList.innerHTML = sideHtml;

    // Listeners para items laterales
    modalSidebarList.querySelectorAll(".modal-side-item").forEach(el => {
        el.addEventListener("click", () => {
            const idx = Number(el.dataset.index);
            openArticle(idx);
        });
    });

    // Abrir modal y scrollear al inicio del contenido
    modal.classList.add("open");
    modal.setAttribute("aria-hidden", "false");
    if (modalDialog) {
        modalDialog.scrollTop = 0;
    }
}

function closeModal() {
    modal.classList.remove("open");
    modal.setAttribute("aria-hidden", "true");
}

// Cerrar modal con botón, fondo o header blanco
document.getElementById("modal-close").addEventListener("click", closeModal);
document.getElementById("modal-backdrop").addEventListener("click", closeModal);
document.getElementById("sticky-header").addEventListener("click", () => {
    if (modal.classList.contains("open")) {
        closeModal();
    } else {
        window.scrollTo({top:0, behavior:"smooth"});
    }
});

// Google Sheet
const sheetId = "1ocZG8kFq8j2sZtg_5k3ZCr8zy0TnkfkXCFOiFV1qLL4";
const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json`;

fetch(url).then(r=>r.text()).then(t=>{
    // Parseo robusto del JSON de Google
    let jsonText = t.substring(t.indexOf("{"), t.lastIndexOf("}") + 1);
    const json = JSON.parse(jsonText);
    allRows = json.table.rows || [];

    const primary = document.getElementById("primary");
    const grid2 = document.getElementById("grid-2x2");
    const feed = document.getElementById("feed");

    /* ---------- PRIMARY NEWS (fila 0) ---------- */
    if (allRows[0] && allRows[0].c) {
        const p = allRows[0].c;
        primary.innerHTML = `
            <div class="news-card" data-index="0">
                <img src="${p[1]?.v || ""}">
                <h1>${p[0]?.v || ""}</h1>
                <h2>${p[2]?.v || ""}</h2>
            </div>
        `;
    }

    /* ---------- 2–5 GRID (filas 1–4) ---------- */
    let g = "";
    for (let i = 1; i <= 4 && i < allRows.length; i++) {
        const c = allRows[i].c;
        if (!c) continue;
        g += `
            <div class="grid-2x2-item news-card" data-index="${i}">
                <img src="${c[1]?.v || ""}">
                <h3>${c[0]?.v || ""}</h3>
            </div>`;
    }
    grid2.innerHTML = g;

    /* ---------- FEED 6+ (filas 5 en adelante) ---------- */
    let f = "";
    for (let i = 5; i < allRows.length; i++) {
        const c = allRows[i].c;
        if (!c) continue;
        f += `
            <div class="feed-item news-card" data-index="${i}">
                <img src="${c[1]?.v || ""}">
                <h4>${c[0]?.v || ""}</h4>
            </div>`;
    }
    feed.innerHTML = f;

    // Activar click en todas las noticias
    document.querySelectorAll(".news-card").forEach(card => {
        card.addEventListener("click", () => {
            const idx = Number(card.dataset.index);
            openArticle(idx);
        });
    });
});
</script>

</body>
</html>
